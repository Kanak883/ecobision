<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoScan - Waste Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f9eb;
            color: #2c3e50;
        }

        #container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .camera-box {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        #webcam {
            width: 100%;
            border-radius: 10px;
        }

        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            display: block;
            margin: 15px auto;
        }

        button:hover {
            background: #219a52;
        }

        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .material-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 8px;
        }

        .plastic { background: #ff4757; color: white; }
        .paper { background: #2ed573; color: white; }
        .metal { background: #3498db; color: white; }
        .unknown { background: #95a5a6; color: white; }
    </style>
</head>
<body>
    <div id="container">
        <h1>ðŸŒ± EcoScan</h1>
        <p class="subtitle">Point your camera at waste to analyze its environmental impact</p>

        <div class="camera-box">
            <video id="webcam" autoplay muted playsinline></video>
            <button id="scanButton">Start Scanning</button>
        </div>

        <div id="results"></div>
        <div id="impactInfo"></div>
    </div>

    <script>
        let net;
        let isScanning = false;
        const materialMap = {
            'bottle': 'plastic',
            'can': 'metal',
            'cup': 'plastic',
            'book': 'paper',
            'cell phone': 'metal',
            'banana': 'organic'
        };

        const impactData = {
            'plastic': {
                decomposition: '450-1000 years',
                co2: '6 kg CO2 per kg',
                tip: 'Recycle through proper channels or switch to reusable alternatives'
            },
            'metal': {
                decomposition: '50-200 years',
                co2: '2.5 kg CO2 per kg',
                tip: 'Recycle indefinitely - metal retains properties when recycled'
            },
            'paper': {
                decomposition: '2-6 weeks',
                co2: '1 kg CO2 per kg',
                tip: 'Compost or recycle - avoid wet contamination'
            }
        };

        async function setupWebcam() {
            const video = document.getElementById('webcam');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.width = video.videoWidth;
                        video.height = video.videoHeight;
                        resolve(video);
                    };
                });
            } catch (err) {
                console.error("Camera error:", err);
                alert("Please enable camera access to use this feature");
                return null;
            }
        }

        async function detectObjects() {
            const video = document.getElementById('webcam');
            const resultsDiv = document.getElementById('results');
            
            if (!video || !net) return;

            const objects = await net.detect(video);
            resultsDiv.innerHTML = '';

            objects.forEach(obj => {
                const material = materialMap[obj.class] || 'unknown';
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <strong>${obj.class}</strong> (${Math.round(obj.score * 100)}%)
                    <div class="material-tag ${material}">${material}</div>
                    <div class="impact-info" style="margin-top: 10px; font-size: 0.9em;">
                        ${impactData[material] ? `
                            Decomposes in: ${impactData[material].decomposition}<br>
                            ${impactData[material].tip}
                        ` : 'Environmental impact data not available'}
                    </div>
                `;
                resultsDiv.appendChild(card);
            });

            if (isScanning) {
                requestAnimationFrame(detectObjects);
            }
        }

        document.getElementById('scanButton').addEventListener('click', async () => {
            if (!isScanning) {
                const video = await setupWebcam();
                if (video) {
                    if (!net) {
                        net = await cocoSsd.load();
                    }
                    isScanning = true;
                    document.getElementById('scanButton').textContent = 'Stop Scanning';
                    detectObjects();
                }
            } else {
                isScanning = false;
                document.getElementById('scanButton').textContent = 'Start Scanning';
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                }
            }
        });

        // Initial model load
        cocoSsd.load().then(model => {
            net = model;
        });
    </script>
</body>
</html>
